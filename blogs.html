<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K1n9's blog space</title>
    <script type="module" src="js/dyn.js"></script>
    <style> 
    
    canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

    html {
        height: 100%;
        overflow-x: hidden;
        font-family: Arial, sans-serif;
        scroll-behavior: smooth;
    }

    .glassStack {
            height: 200px;
            width: 90%;
            transition: opacity 0.25s ease;
            padding-left: 5%;
            overflow: scroll;
            position: relative;
        }

        .glassStack.hovered {
            height: 1000px;

        }
        .fullscreenStack
        {
            height: 100vh !important;
        }
        
        .grow {
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.6);
            z-index:99;
        }
        .visible-1 {
            opacity: 0.75 !important;
        }

        .visible-2 {
            opacity: 0.5 !important;
        }

        .visible-3 {
            opacity: 0.25 !important;
        }
        .visible-4 {
            opacity: 0.0 !important;
        }

        .glassStackItem {
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        backdrop-filter: blur(4.5px);
        border-radius: 10px;
        width: 90%;
        position: absolute;
        /* transition: all 0.25s ease-in-out; */
        transition: opacity 0.25s ease;
        transition: transform 0.25s ease;
        overflow: hidden;
        display: none;
    }

    .glassStackItemContent {
        transition: opacity 0.25s ease;
        max-height: 50px;
        height: 50px;
        min-height: 50px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .glassStackItemContent.hovered {
        max-height: 500px !important;
        height: auto !important;
    }
    </style>
</head>
<body>
    <canvas></canvas>
   
    <div class="glassStack fullscreenStack" dyn="n-7...0" record="./blogs.txt" plate="./plates/BlogEntry.html" shape="ParseForBlogs"></div> 
</body>

<script>
    function ParseForBlogs(data) {
    return data
        .split('---')
        .map(section => section.split("\n"))
        .map(lines => ({
            Date: lines[0],
            Title: lines[1],
            Header: lines[2],
            Text: lines[3]
        }))
    }

        // Starry Background Animation Code
        // Created By 'Merve'
        //Lifted From https://codepen.io/mervedurdagi/pen/PWzmZR
        var n_stars = 150;
        var n_stars = 150;
        var colors = ['#ba2356', '#fb9b39'];
        for (let i = 0; i < 3; i++) {
            colors.push('#fff');
        }

        var canvas = document.querySelector('canvas');
        var c = canvas.getContext('2d');
        let canvasRect = canvas.getBoundingClientRect();
        function resizeCanvas() {
            const dpi = window.devicePixelRatio;
            canvas.width = innerWidth * dpi;
            canvas.height = innerHeight * dpi;
            canvasRect = canvas.getBoundingClientRect();
            c.restore()
            c.scale(dpi, dpi);
        }
        resizeCanvas()

        addEventListener('resize', () => {
            resizeCanvas()
            stars = [];
            init();
        });

        canvas.style.background = '#000';
        const randomInt = (max, min) => Math.floor(Math.random() * (max - min) + min);canvas
        class Star {
            constructor(x, y, radius, color, dy = -Math.random() * .3, dx = 0, velocityStar = false) {

                if (dx != 0) {
                    dx = dx - Math.random();
                }

                this.x = x || randomInt(0, canvasRect.width);
                this.y = y || randomInt(0, canvasRect.height);
                this.radius = radius || Math.random() * 1.1;
                this.color = color || colors[randomInt(0, colors.length)];
                this.dy = dy;
                this.dx = dx
                this.VelocityStar = velocityStar
                this.opacity = .5;
            }

            draw() {
                c.beginPath();
                c.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                c.shadowBlur = randomInt(3, 15);
                c.shadowColor = this.color;
                c.strokeStyle = this.color;
                c.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                c.fill();
                c.stroke();
                c.closePath();
            }

            update(arrayStars = []) {
                if (this.y - this.radius < 0) {
                    this.createNewStar(arrayStars);
                }
                this.y += this.dy;
                this.x += this.dx;
                if (this.dy <= 0.01 || this.dx <= 0.01) {
                    this.opacity -= .01;
                }
                if ((this.x > canvas.width || this.y > canvas.height || this.x < 0 || this.y < 0 || this.opacity <= 0) && this.VelocityStar) {
                    this.deleteStar(arrayStars);
                } else {
                    this.draw();
                }
            }

            deleteStar(arrayStars = []) {
                let i = arrayStars.indexOf(this);
                arrayStars.splice(i, 1);
            }

            createNewStar(arrayStars = []) {
                let i = arrayStars.indexOf(this);
                arrayStars.splice(i, 1);
                arrayStars.push(new Star(false, canvasRect.height + 5, undefined, undefined, this.dy));
            }

        }

        var stars = [];
        var velocityStars = [];
        function init() {
            for (let i = 0; i < n_stars; i++) {
                stars.push(new Star());
            }
        }
        init();



  

        var bg = c.createRadialGradient(canvasRect.width / 2, canvasRect.height * 2, canvasRect.height, canvasRect.width / 2, canvasRect.height, canvasRect.height * 4);
        bg.addColorStop(0, "#300d82");
        bg.addColorStop(.4, "#000814");
        bg.addColorStop(.8, "#000814");
        bg.addColorStop(1, "#000");

        // document.addEventListener('click', (e) => {
        //     let x = e.clientX;
        //     let y = e.clientY;
        //     let numBurstStars = 5;
        //     for (let i = 0; i < numBurstStars; i++) {
        //         MakeVelocityStar(x, y);
        //     }
        // });

        // document.addEventListener('mousemove', (() => {
        //     let mouseMoveCounter = 0;

        //     return (e) => {
        //         mouseMoveCounter++;
        //         if (mouseMoveCounter >= 10) {
        //             MakeVelocityStar(e.clientX, e.clientY);
        //             mouseMoveCounter = 0;
        //         }
        //     };
        // })());

        // function MakeVelocityStar(x, y) {
        //     let starPosFromCords = 5;
        //     let angle = Math.random() * 2 * Math.PI;
        //     let randDistfromCord = Math.random() * starPosFromCords;
        //     let dx = Math.cos(angle) * randDistfromCord;
        //     let dy = Math.sin(angle) * randDistfromCord;

        //     velocityStars.push(new Star(x, y, Math.random() * 4 + 1, undefined, dx, dy, true));
        // }

        function animate() {
            requestAnimationFrame(animate);
            c.clearRect(0, 0, canvasRect.width, canvasRect.height);
            c.fillStyle = bg;
            c.fillRect(0, 0, canvasRect.width, canvasRect.height);
            stars.forEach(s => s.update(stars));
            velocityStars.forEach(s => s.update(velocityStars));
        }
        animate();

        const glassStack = document.querySelector('.glassStack');

        const scrollableElement = glassStack;
        const triggerPoint = 7; 
        
        function createGlassStack() {
            console.log('eyy');
            let opacityCounter = 1.0
            let countLength = glassStack.children.length >= 3 ? 3 : glassStack.children.length;
            for (let i = 0; i < countLength; i++) {

                if (i === 0) {
                    glassStack.children[i].style.backgroundColor = 'rgba(255, 255, 255, 0.5)';
                }
                glassStack.children[i].classList.add('glassStackItemDisplay');
                glassStack.children[i].style.marginTop = `${i * 10}px`;
                glassStack.children[i].style.opacity = `${opacityCounter}`;
                glassStack.children[i].style.zIndex = glassStack.children.length - i;
                opacityCounter -= 0.3;
            }
            
        }

            function ExpandStack()
            {
                let summationHeight = 0;
            glassStack.classList.add('hovered');
            for (let i = 0; i < glassStack.children.length; i++) {
                glassStack.children[i].classList.add('glassStackItemDisplay');
                glassStack.children[i].children[0].classList.add('hovered');
                glassStack.children[i].style.backgroundColor = '';
                //glassStack.children[i].style.opacity = `1.0`;

                if (i !== 0) {
                    summationHeight += glassStack.children[i - 1].clientHeight + 20;
                    glassStack.children[i].style.marginTop = `${summationHeight}px`;
                }

            }
            }

            function ShrinkStack()
            {
                glassStack.classList.remove('hovered');
            for (let i = 0; i < glassStack.children.length; i++) {
                glassStack.children[i].classList.remove('glassStackItemDisplay');
                glassStack.children[i].classList.remove('grow', 'visible-1', 'visible-2', 'visible-3');
                glassStack.children[i].children[0].classList.remove('hovered');
            }
            createGlassStack();
            }
            let expanded = false;

            // document.addEventListener('click',function() {
            //     if (!expanded) {
            //         ExpandStack();
            //         expanded = !expanded;
            //     } else {
            //         ShrinkStack();
            //         expanded = !expanded;
            //     }
            // });

        function getMiddleElement() {
            const scrollRect = glassStack.getBoundingClientRect();
            const middleY = scrollRect.top + scrollRect.height / 3.5;

            let closestElement = null;
            let closestDistance = Infinity;

            for (let i = 0; i < glassStack.children.length; i++) {
                const itemRect = glassStack.children[i].getBoundingClientRect();
                const itemMiddleY = itemRect.top + itemRect.height / 2;
                const distance = Math.abs(itemMiddleY - middleY);

                if (distance < closestDistance) {
                    closestDistance = distance;
                    closestElement = glassStack.children[i];
                }
            }
            return closestElement;
        }

        function applyGrowingEffect() {
            for (let i = 0; i < glassStack.children.length; i++) {
                glassStack.children[i].classList.remove('grow')
                glassStack.children[i].classList.add('visible-4')
                glassStack.children[i].classList.remove('visible-1')
                glassStack.children[i].classList.remove('visible-2')
                glassStack.children[i].classList.remove('visible-3')
            }
           const middleElement = getMiddleElement();
            if (middleElement) {
                middleElement.classList.add('grow'); // Apply grow effect to the middle element

                // Get the index of the middle element
                const middleIndex = Array.from(glassStack.children).indexOf(middleElement);
                glassStack.children[middleIndex].classList.remove('visible-4');
                console.log(middleIndex);
                // Apply opacity levels to the items above and below the middle element
                if (middleIndex > 0)
                {
                    console.log('added 1 top')
                    glassStack.children[middleIndex - 1].classList.remove('visible-4');
                    glassStack.children[middleIndex - 1].classList.add('visible-3');
                } 

                if (middleIndex < glassStack.children.length - 1) 
                {
                    console.log('added 1 bottom')
                    glassStack.children[middleIndex + 1].classList.remove('visible-4');
                    glassStack.children[middleIndex + 1].classList.add('visible-1');
                } 
                if (middleIndex < glassStack.children.length - 2) 
                {
                    console.log('added 2 bottom')
                    glassStack.children[middleIndex +2].classList.remove('visible-4');
                    glassStack.children[middleIndex + 2].classList.add('visible-3');
                }
            }
        }

        glassStack.addEventListener('scroll', () => {
            if (glassStack.classList.contains('hovered')) {
                applyGrowingEffect();
            }
        });

        createGlassStack();

</script>
</html>
